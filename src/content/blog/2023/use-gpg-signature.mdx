---
title: ä½¿ç”¨ GPG ç­¾å
description: ç”Ÿæˆ GPG å¯†é’¥ç”¨äº Git æäº¤
createdTime: 2023-09-17
tags: ['git', 'signature', 'gpg']
---

é™¤äº† SSH å¯†é’¥å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ GPG å¯†é’¥æ¥å¯¹ Git æäº¤è¿›è¡Œç­¾åã€‚GPG æ˜¯ä¸€ä¸ªç”¨äºåŠ å¯†å’Œç­¾åæ•°æ®çš„å¼€æºåŠ å¯†å·¥å…·ã€‚é€šè¿‡ä½¿ç”¨ GPG å¯†é’¥ï¼Œä½ å¯ä»¥ç¡®ä¿ä½ çš„æäº¤æ˜¯ç”±ä½ æœ¬äººåˆ›å»ºçš„ã€‚

## åˆ›å»ºä¸€ä¸ª GPG å¯†é’¥ ç”¨äº Git commit

ä»¥ä¸‹æ˜¯åœ¨ macOS ä¸Šç”Ÿæˆ GPG å¯†é’¥çš„æ­¥éª¤ï¼š

1. é¦–å…ˆï¼Œä½ éœ€è¦å®‰è£… GnuPGã€‚åœ¨ macOS ä¸Šï¼Œä½ å¯ä»¥é€šè¿‡ Homebrew æ¥å®‰è£…ã€‚å¦‚æœä½ è¿˜æ²¡æœ‰å®‰è£… Homebrewï¼Œä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ¥å®‰è£…ï¼š

    ```zsh
    /bin/zsh -c "$(curl -fsSL <https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh>)"
    ```

2. ç„¶åï¼Œé€šè¿‡ä»¥ä¸‹å‘½ä»¤æ¥å®‰è£… GnuPGï¼š

    ```zsh
    brew install gnupg
    ```

3. ç”Ÿæˆæ–°çš„ GPG å¯†é’¥ã€‚åœ¨ç»ˆç«¯ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥å¼€å§‹ç”Ÿæˆå¯†é’¥ï¼š

    ```zsh
    gpg --full-generate-key
    ```

4. æ¥ä¸‹æ¥ï¼Œå®ƒä¼šè¯¢é—®ä½ è¦ç”Ÿæˆå“ªç§ç±»å‹çš„å¯†é’¥ã€‚é€‰æ‹©â€œ1â€ï¼ˆRSA å’Œ RSAï¼‰ã€‚
5. ç„¶åï¼Œå®ƒä¼šè¯¢é—®ä½ çš„å¯†é’¥çš„å¤§å°ã€‚å»ºè®®ä½ é€‰æ‹© 4096ã€‚
6. æ¥ä¸‹æ¥ï¼Œå®ƒä¼šè¯¢é—®ä½ çš„å¯†é’¥çš„æœ‰æ•ˆæœŸã€‚ä½ å¯ä»¥æ ¹æ®ä½ çš„éœ€è¦è®¾ç½®ï¼Œæˆ–è€…é€‰æ‹©â€œ0â€è¡¨ç¤ºå¯†é’¥æ°¸ä¸è¿‡æœŸã€‚
7. æ¥ä¸‹æ¥ï¼Œå®ƒä¼šè¦æ±‚ä½ ç¡®è®¤ä½ çš„é€‰æ‹©ï¼Œå¹¶è¾“å…¥ä½ çš„ç”¨æˆ·ä¿¡æ¯ã€‚è¿™åŒ…æ‹¬ä½ çš„åå­—ï¼Œç”µå­é‚®ä»¶åœ°å€ï¼Œä»¥åŠä¸€ä¸ªå¯é€‰çš„æ³¨é‡Šã€‚ä½ éœ€è¦ç¡®ä¿ä½ è¾“å…¥çš„ç”µå­é‚®ä»¶åœ°å€ä¸ä½ çš„ GitHub å¸æˆ·çš„ç”µå­é‚®ä»¶åœ°å€ç›¸åŒ¹é…ã€‚
8. æœ€åï¼Œå®ƒä¼šè¦æ±‚ä½ è¾“å…¥ä¸€ä¸ªå¯†ç æ¥ä¿æŠ¤ä½ çš„å¯†é’¥ã€‚
9. ç”Ÿæˆå¯†é’¥åï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥åˆ—å‡ºä½ çš„ GPG å¯†é’¥ï¼š

    ```zsh
    gpg --list-secret-keys --keyid-format LONG
    ```

10. åœ¨åˆ—å‡ºçš„ä¿¡æ¯ä¸­ï¼Œå¤åˆ¶â€œGPG å¯†é’¥ IDâ€éƒ¨åˆ†çš„é•¿ IDã€‚
11. å°†ä½ çš„ GPG å¯†é’¥æ·»åŠ åˆ°ä½ çš„ GitHub è´¦æˆ·ã€‚åœ¨ GitHub çš„è®¾ç½®ä¸­ï¼Œç‚¹å‡»â€œSSH å’Œ GPG å¯†é’¥â€ï¼Œç„¶åç‚¹å‡»â€œæ–°çš„ GPG å¯†é’¥â€ã€‚åœ¨â€œKeyâ€å­—æ®µä¸­ï¼Œç²˜è´´ä½ çš„ GPG å¯†é’¥ã€‚
12. æœ€åï¼Œå‘Šè¯‰ Git ä½¿ç”¨ä½ çš„ GPG å¯†é’¥ã€‚è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå°† `<key>` æ›¿æ¢ä¸ºä½ çš„ GPG å¯†é’¥ IDï¼š

    ï¼ˆä¸æ¨èå…¨å±€é…ç½®ï¼‰

    ```zsh
    git config --global user.signingkey <key>
    git config --global commit.gpgsign true
    ```

    é‚£ä»€ä¹ˆæ˜¯ â€œGPG å¯†é’¥ IDâ€ å‘¢ï¼Ÿ

    - GPG å¯†é’¥ ID
        1. ä½¿ç”¨Â `gpg --list-secret-keys --keyid-format=long`Â å‘½ä»¤åˆ—å‡ºä½ æ‹¥æœ‰å…¶å…¬é’¥å’Œç§é’¥çš„é•¿å½¢å¼ GPG å¯†é’¥ã€‚ç­¾åæäº¤æˆ–æ ‡è®°éœ€è¦ç§é’¥ã€‚

            ```zsh
            gpg --list-secret-keys --keyid-format=long
            ```

            æ³¨æ„ï¼šLinux ä¸Šçš„æŸäº› GPG å®‰è£…å¯èƒ½éœ€è¦æ”¹ç”¨Â `gpg2 --list-keys --keyid-format LONG`Â æŸ¥çœ‹ç°æœ‰å¯†é’¥çš„åˆ—è¡¨ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¿˜éœ€è¦é€šè¿‡è¿è¡ŒÂ `git config --global gpg.program gpg2`Â æ¥é…ç½® Git ä»¥ä½¿ç”¨Â `gpg2`ã€‚

        2. ä» GPG å¯†é’¥åˆ—è¡¨ä¸­å¤åˆ¶æ‚¨æƒ³è¦ä½¿ç”¨çš„ GPG å¯†é’¥ ID çš„é•¿å½¢å¼ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼ŒGPG å¯†é’¥ ID ä¸ºÂ `3AA5C34371567BD2`ï¼š

            ```zsh
            $ gpg --list-secret-keys --keyid-format=long
            /Users/hubot/.gnupg/secring.gpg
            ------------------------------------
            sec   4096R/3AA5C34371567BD2 2016-03-10 [expires: 2017-03-10]
            uid                          Hubot <hubot@example.com>
            ssb   4096R/4BB6D45482678BE3 2016-03-10
            ```


    å‡å¦‚ä½ çš„ä¸€å°ç”µè„‘ä¸Šæœ‰å¤šä¸ªä¸åŒçš„æäº¤ä¿¡æ¯é…ç½®ï¼Œä¸”ä½ åˆæƒ³æ¯ä¸ªæäº¤ä¿¡æ¯ç”¨ä¸åŒçš„ GPG é…ç½®ï¼Œå¯ä»¥è¿™æ ·åšï¼š

    - å…·ä½“åšæ³•



è¿™æ ·ï¼Œä½ å°±å¯ä»¥ä½¿ç”¨ä½ çš„ GPG å¯†é’¥è¿›è¡Œ Git æäº¤äº†ã€‚

```zsh
â¯ gpg --full-generate-key
ğŸ‰ Start executing the commandï¼[2023-09-12 21:47:08]

gpg (GnuPG) 2.4.3; Copyright (C) 2023 g10 Code GmbH
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.

Please select what kind of key you want:
   (1) RSA and RSA
   (2) DSA and Elgamal
   (3) DSA (sign only)
   (4) RSA (sign only)
   (9) ECC (sign and encrypt) *default*
  (10) ECC (sign only)
  (14) Existing key from card
Your selection? 1
RSA keys may be between 1024 and 4096 bits long.
What keysize do you want? (3072) 4096
Requested keysize is 4096 bits
Please specify how long the key should be valid.
         0 = key does not expire
      <n>  = key expires in n days
      <n>w = key expires in n weeks
      <n>m = key expires in n months
      <n>y = key expires in n years
Key is valid for? (0) 0
Key does not expire at all
Is this correct? (y/N) y

GnuPG needs to construct a user ID to identify your key.

Real name: work_user_name
Email address: work_user_name@404.com
Comment: used for work
You selected this USER-ID:
    "work_user_name (used for work) <work_user_name@404.com>"

Change (N)ame, (C)omment, (E)mail or (O)kay/(Q)uit? O
We need to generate a lot of random bytes. It is a good idea to perform
some other action (type on the keyboard, move the mouse, utilize the
disks) during the prime generation; this gives the random number
generator a better chance to gain enough entropy.
We need to generate a lot of random bytes. It is a good idea to perform
some other action (type on the keyboard, move the mouse, utilize the
disks) during the prime generation; this gives the random number
generator a better chance to gain enough entropy.
gpg: revocation certificate stored as '/Users/your_user_name/.gnupg/openpgp-revocs.d/8E797F6F7******************361558.rev'
public and secret key created and signed.

pub   rsa4096 2023-09-12 [SC]
      8E797F6F7******************361558
uid                      work_user_name (used for work) <work_user_name@404.com>
sub   rsa4096 2023-09-12 [E]
```

## å‚è€ƒèµ„æ–™

- [ç”Ÿæˆæ–° GPG å¯†é’¥](https://docs.github.com/zh/authentication/managing-commit-signature-verification/generating-a-new-gpg-key)